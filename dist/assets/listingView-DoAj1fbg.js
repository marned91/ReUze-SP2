import{f as L}from"./listings-gFXpV0t2.js";import{d as B,b as I}from"./doFetch-DiDBEFLs.js";import{a as v}from"./profile-DJ92duJc.js";import{h as d}from"./main-Cbclldai.js";import{s as D,h as S}from"./skeletonLoader-U1K08Fq0.js";async function A(e,t){const a=`${I}/${e}/bids`,l={method:"POST",body:JSON.stringify({amount:t})},o=await B(a,l);return o||(console.error("Failed to place bid"),null)}async function P(e,t,a){const l=localStorage.getItem("token"),m=JSON.parse(localStorage.getItem("user"))?.name,n=document.getElementById("bid-button"),c=n.textContent;if(!l){d("You must be logged in to place a bid.","error");return}const i=Number(t);if(isNaN(i)||i<=0){d("Please enter a valid bid amount.","error");return}n.disabled=!0,n.textContent="Placing bid...";try{const u=(await v(m)).credits;if(i>u){d("You do not have enough credits to place this bid.","error");return}const s=await L(e),r=(s.bids.length>0?s.bids[s.bids.length-1].amount:0)+i;await A(e,r)&&(d(`Your bid of $${i} has been placed! The new current bid is $${r}.`,"success"),a())}catch{d("Failed to place bid. Please try again.","error")}finally{n.disabled=!1,n.textContent=c}}async function w(){const e=document.getElementById("single-listing-container");e.classList.add("hidden"),D();const t=await L();if(e.classList.remove("hidden"),S(),!t){d("Listing not found. Please reload the page","error");return}const a=document.getElementById("single-listing-image"),l=document.getElementById("single-listing-info");a.innerHTML="",l.innerHTML="";const o=document.createElement("img");o.src=t.media?.[0]?.url||"/assets/default-listing-image.png",o.alt=t.media?.[0]?.alt||t.title||"Listing image",o.classList.add("w-full","max-h-[400px]","object-cover","rounded-3xl"),a.appendChild(o);const m=document.createElement("div");m.classList.add("flex","items-center","gap-4","flex-wrap");const n=document.createElement("h1");n.textContent=t.title||"No title available",n.classList.add("font-largeFont","text-4xl");const c=document.createElement("div");c.classList.add("flex","flex-wrap","gap-1");const i=new Date,u=new Date(t.endsAt)>i?"active":"expired",s=document.createElement("span");s.textContent=u,s.classList.add("rounded-full","text-white","text-xs","px-3","py-1.5",u==="active"?"bg-accent-dark":"bg-accent-light"),c.appendChild(s),t.tags&&t.tags.length>0&&t.tags.forEach(C=>{const b=document.createElement("span");b.textContent=C,b.classList.add("rounded-full","bg-brand-dark","text-white","text-xs","px-3","py-1.5"),c.appendChild(b)}),m.append(n,c);const g=document.createElement("p");g.textContent=t.description||"No description added.",g.classList.add("font-smallFont","italic","mt-7");const r=document.createElement("p");r.textContent=`Deadline: ${new Date(t.endsAt).toLocaleString()}`,r.classList.add("font-smallFont","font-medium","text-m","mt-10");const f=document.createElement("p");f.textContent=`Bids: ${t._count.bids}`,f.classList.add("text-m","font-smallFont","font-medium","mt-2");const p=document.createElement("p");p.classList.add("font-smallFont","font-bold","mt-2","text-xl"),t._count?.bids>0?p.textContent=`Current bid: $${t.bids[t.bids.length-1].amount}`:p.textContent="No bids yet.",l.append(m,g,r,f,p);const x=document.getElementById("bid-form"),y=localStorage.getItem("token"),E=new Date(t.endsAt);y&&E>new Date?x.classList.remove("hidden"):x.classList.add("hidden")}const $=document.getElementById("bid-button"),k=new URLSearchParams(window.location.search),F=k.get("id");$.addEventListener("click",async e=>{e.preventDefault();const t=document.getElementById("bid-amount").value;try{const a=await P(F,t,w)}catch{d("Failed to place bid. Please try again.")}});w();
//# sourceMappingURL=listingView-DoAj1fbg.js.map
