{"version":3,"file":"listingView.uODPKLBp.js","sources":["../../src/script/api/bid.mjs","../../src/script/utils/handleBid.mjs","../../src/script/router/views/listingView.mjs"],"sourcesContent":["import { doFetch } from './doFetch.mjs'\nimport { API_AUCTION } from './constants.mjs'\n\n/**\n * Places a bid on a specific auction listing.\n *\n * This function sends a POST request to the auction API, submitting a bid amount for the specified listing.\n *\n * @param {string} listingId - The ID of the auction listing to bid on.\n * @param {number} bidAmount - The amount of the bid being placed.\n * @returns {Promise<Object|null>} A promise that resolves to the bid response if successful, or null if the bid fails.\n * @throws {Error} If the request encounters an issue.\n *\n * @example\n * const listingId = \"12345\";\n * const bidAmount = 100;\n * const bidResponse = await placeBid(listingId, bidAmount);\n */\n\nexport async function placeBid(listingId, bidAmount) {\n  const url = `${API_AUCTION}/${listingId}/bids`\n\n  const options = {\n    method: 'POST',\n    body: JSON.stringify({ amount: bidAmount }),\n  }\n\n  const data = await doFetch(url, options)\n\n  if (!data) {\n    console.error('Failed to place bid')\n    return null\n  }\n\n  return data\n}\n","import { placeBid } from '../api/bid.mjs'\nimport { fetchSingleListing } from '../api/listings.mjs'\nimport { fetchProfileData } from '../api/profile.mjs'\nimport { handleAlert } from '../global/handleAlerts.mjs'\n\n/**\n * Handles placing a bid on a listing, including checks for user authentication, credits, and valid bid amount.\n * Updates the listing with the new bid if successful.\n *\n * @param {string} listingId - The ID of the listing where the bid is being placed.\n * @param {number} bidAmount - The amount the user is bidding.\n * @param {function} displaySingleListing - A function to refresh the listing view after the bid is placed.\n */\nexport async function handleBid(listingId, bidAmount, displaySingleListing) {\n  const token = localStorage.getItem('token')\n  const userInfo = JSON.parse(localStorage.getItem('user'))\n  const username = userInfo?.name\n\n  const bidButton = document.getElementById('bid-button') // Get the button\n  const originalButtonText = bidButton.textContent\n\n  if (!token) {\n    handleAlert('You must be logged in to place a bid.', 'error')\n    return\n  }\n\n  const numericBidAmount = Number(bidAmount)\n  if (isNaN(numericBidAmount) || numericBidAmount <= 0) {\n    handleAlert('Please enter a valid bid amount.', 'error')\n    return\n  }\n\n  bidButton.disabled = true\n  bidButton.textContent = 'Placing bid...'\n\n  try {\n    const profile = await fetchProfileData(username)\n    const availableCredits = profile.credits\n    if (numericBidAmount > availableCredits) {\n      handleAlert('You do not have enough credits to place this bid.', 'error')\n      return\n    }\n\n    const listing = await fetchSingleListing(listingId) // Get the current listing\n    const currentBid =\n      listing.bids.length > 0 ? listing.bids[listing.bids.length - 1].amount : 0\n    const newBid = currentBid + numericBidAmount\n\n    const result = await placeBid(listingId, newBid)\n\n    if (result) {\n      handleAlert(\n        `Your bid of $${numericBidAmount} has been placed! The new current bid is $${newBid}.`,\n        'success',\n      )\n      displaySingleListing() // Refresh the listing to show the updated bid\n    }\n  } catch (error) {\n    handleAlert('Failed to place bid. Please try again.', 'error')\n  } finally {\n    bidButton.disabled = false\n    bidButton.textContent = originalButtonText\n  }\n}\n","import { fetchSingleListing } from '../../api/listings.mjs'\nimport { handleBid } from '../../utils/handleBid.mjs'\nimport { handleAlert } from '../../global/handleAlerts.mjs'\nimport {\n  showSkeletonLoader,\n  hideSkeletonLoader,\n} from '../../utils/skeletonLoader.mjs'\n\n/**\n * Displays a single listing's details.\n *\n * This function fetches a single listing using the `fetchSingleListing` function, processes its data,\n * and dynamically populates the page with details such as the listing's image, title, description, deadline,\n * bid count, bid information, and status (active or expired).\n * It also shows the bidding option if the listing is still active and the user is authenticated.\n *\n * @async\n * @returns {Promise<void>} - A promise that resolves when the single listing has been displayed.\n *\n * @example\n * // This will display the details of a single listing.\n * displaySingleListing();\n *\n */\n\nasync function displaySingleListing() {\n  const contentContainer = document.getElementById('single-listing-container')\n  contentContainer.classList.add('hidden')\n\n  showSkeletonLoader()\n\n  const listing = await fetchSingleListing()\n\n  contentContainer.classList.remove('hidden')\n\n  hideSkeletonLoader()\n\n  if (!listing) {\n    handleAlert('Listing not found. Please reload the page', 'error')\n    return\n  }\n\n  const singleListingImage = document.getElementById('single-listing-image')\n  const singleListingInfo = document.getElementById('single-listing-info')\n\n  singleListingImage.innerHTML = ''\n  singleListingInfo.innerHTML = ''\n\n  // Create image element\n  const img = document.createElement('img')\n  img.src = listing.media?.[0]?.url || '/assets/default-listing-image.png'\n  img.alt = listing.media?.[0]?.alt || listing.title || 'Listing image'\n  img.classList.add('w-full', 'max-h-[400px]', 'object-cover', 'rounded-3xl')\n  singleListingImage.appendChild(img)\n\n  // Create title container\n  const titleContainer = document.createElement('div')\n  titleContainer.classList.add('flex', 'items-center', 'gap-4', 'flex-wrap')\n\n  // Create title element\n  const title = document.createElement('h1')\n  title.textContent = listing.title || 'No title available'\n  title.classList.add('font-largeFont', 'text-4xl')\n\n  // Create tags container\n  const tagsDiv = document.createElement('div')\n  tagsDiv.classList.add('flex', 'flex-wrap', 'gap-1')\n\n  // Add status tag\n  const currentDateTag = new Date()\n  const endAtDate = new Date(listing.endsAt)\n  const status = endAtDate > currentDateTag ? 'active' : 'expired'\n\n  const statusElement = document.createElement('span')\n  statusElement.textContent = status\n  statusElement.classList.add(\n    'rounded-full',\n    'text-white',\n    'text-xs',\n    'px-3',\n    'py-1.5',\n    status === 'active' ? 'bg-accent-dark' : 'bg-accent-light',\n  )\n  tagsDiv.appendChild(statusElement)\n\n  // Add listing tags\n  if (listing.tags && listing.tags.length > 0) {\n    listing.tags.forEach((tag) => {\n      const tagElement = document.createElement('span')\n      tagElement.textContent = tag\n      tagElement.classList.add(\n        'rounded-full',\n        'bg-brand-dark',\n        'text-white',\n        'text-xs',\n        'px-3',\n        'py-1.5',\n      )\n      tagsDiv.appendChild(tagElement)\n    })\n  }\n\n  // Append title and tags together\n  titleContainer.append(title, tagsDiv)\n\n  const description = document.createElement('p')\n  description.textContent = listing.description || 'No description added.'\n  description.classList.add('font-smallFont', 'italic', 'mt-7')\n\n  const deadline = document.createElement('p')\n  deadline.textContent = `Deadline: ${new Date(listing.endsAt).toLocaleString()}`\n  deadline.classList.add('font-smallFont', 'font-medium', 'text-m', 'mt-10')\n\n  const bidCount = document.createElement('p')\n  bidCount.textContent = `Bids: ${listing._count.bids}`\n  bidCount.classList.add('text-m', 'font-smallFont', 'font-medium', 'mt-2')\n\n  const bidInfo = document.createElement('p')\n  bidInfo.classList.add('font-smallFont', 'font-bold', 'mt-2', 'text-xl')\n  if (listing._count?.bids > 0) {\n    bidInfo.textContent = `Current bid: $${listing.bids[listing.bids.length - 1].amount}`\n  } else {\n    bidInfo.textContent = 'No bids yet.'\n  }\n\n  singleListingInfo.append(\n    titleContainer,\n    description,\n    deadline,\n    bidCount,\n    bidInfo,\n  )\n\n  const biddingOption = document.getElementById('bid-form')\n  const token = localStorage.getItem('token')\n  const endsAt = new Date(listing.endsAt)\n  const currentDate = new Date()\n\n  if (token && endsAt > currentDate) {\n    biddingOption.classList.remove('hidden')\n  } else {\n    biddingOption.classList.add('hidden')\n  }\n}\n\nconst bidButton = document.getElementById('bid-button')\n\nconst urlParams = new URLSearchParams(window.location.search)\nconst listingId = urlParams.get('id')\n\nbidButton.addEventListener('click', async (event) => {\n  event.preventDefault()\n\n  const bidAmount = document.getElementById('bid-amount').value\n\n  try {\n    const result = await handleBid(listingId, bidAmount, displaySingleListing)\n  } catch (error) {\n    handleAlert('Failed to place bid. Please try again.')\n  }\n})\n\ndisplaySingleListing()\n"],"names":["placeBid","listingId","bidAmount","url","API_AUCTION","options","data","doFetch","handleBid","displaySingleListing","token","username","bidButton","originalButtonText","handleAlert","numericBidAmount","availableCredits","fetchProfileData","listing","fetchSingleListing","newBid","contentContainer","showSkeletonLoader","hideSkeletonLoader","singleListingImage","singleListingInfo","img","titleContainer","title","tagsDiv","currentDateTag","status","statusElement","tag","tagElement","description","deadline","bidCount","bidInfo","biddingOption","endsAt","urlParams","event","result"],"mappings":"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"}